<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Infinity heroes kingdom map</title>
    <style>
        #app {
            display: block;
            width: 700px;
            height: 700px;
            overflow: scroll;
            float: right;
        }
    </style>

    <script src="dragscroll.js"></script>
</head>

<body>

    <div class="dragscroll" id="app">
        <canvas id="map"></canvas>
    </div>


	<script src="map.js"></script>

	<script type="text/javascript">
		mapData = mapData.items;
        const baseMap = mapData.map;
        const baseMapHigh = mapData.high;

        var canvas = document.getElementById('map');
        var ctx = canvas.getContext('2d');

        var mapWidth = 6400;
        var mapHeight = 3200;

        canvas.width = mapWidth + 100;
        canvas.height = mapHeight + 100;
        ctx.translate(canvas.width / 2, 0);
        //ctx.rotate(Math.PI / 180 * 60, true);


        var mapSize = 100;
        var tileWidth = mapWidth / mapSize;
        var tileHeight = mapHeight / mapSize;
        var sprite = new Image();
        sprite.src = './data/sprite.png';

        function draw() {
            var x = 0;
            var y = 0;

            for (let i = 0; i < mapSize; i++) {
                y = i * tileHeight / 2;
                for (let j = 0; j < mapSize; j++) {
                    let tileCoordinate = getTile(baseMap[i][j]);
                    ctx.drawImage(
                        sprite,
                        tileCoordinate[0],
                        tileCoordinate[1],
                        64,
                        82,
                        x - j * tileWidth / 2,
                        y + tileHeight / 2 - (baseMapHigh[i][j] * 2),
                        64,
                        82
                    );

                    let coord = checkAsset(i, j);

                    if (coord !== false) {
                        console.log(coord);
                        ctx.drawImage(
                            sprite,
                            coord[0],
                            coord[1],
                            coord[2],
                            coord[3],
                            x - j * tileWidth / 2 + 5,
                            y + tileHeight / 2 - (baseMapHigh[i][j] * 2) - 13,
                            50,
                            44
                        );
                    }


                    y += tileHeight / 2;
                }
                x += tileWidth / 2;
            }
            document.getElementById('app').scrollLeft = 2900;
        }

        function checkAsset(x, y) {
            const resources = mapResources();
            for (var resource in resources) {
                if (resources.hasOwnProperty(resource)) {

                    for (let i = 0; i <  resources[resource].length; i++) {
                        if (resources[resource][i][0] === x && resources[resource][i][1] === y) {
                            return resourceAssets()[resource];
                        }
                    }
                }
            }

            return false;
        }

        function mapResources()
        {
            return {
                'oasis': [
                    [25,25],
                    [10,15],
                    [5,2]
                ],
                'ruin': [
                    [6,7]
                ]
            };
        }

        function resourceAssets() {
            return {
                'oasis': [111, 814, 123, 79],
                'ruin': [2, 802, 103, 91],
            }
        }

        function getTile(tileId) {
            return mapping = {
                1: [414, 943],
                10: [638, 738],
                11: [356, 558],
                12: [494, 859],
                13: [638, 905],
                14: [638, 905],
                20: [566, 906],
                21: [740, 943],
                22: [884, 944],
                23: [647, 570],
                24: [484, 943],
                25: [859, 859],
                30: [638, 820],
                31: [282, 564],
                32: [575, 531],
                33: [712, 858],
                34: [484, 943],
                40: [429, 558],
                41: [812, 943],
                42: [533, 673],
                43: [785, 857],
                44: [502, 588],
                45: [930, 858],
                46: [710, 775],
                50: [566, 822],
                51: [494, 775],
                52: [607, 655],
                53: [679, 655],
            }[tileId];
        }

        window.onload = function () {
            draw();
        }

	</script>
</body>

</html>